<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì²­ê°œêµ¬ë¦¬ ê²°ë¡œì§„ë‹¨ AI (v27.0 Pro)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --bg-deep: #e8ecf1;
            --bg-card: #ffffff;
            --bg-card-alt: #f1f3f7;
            --bg-input: #f5f7fa;
            --accent-cyan: #1b3a5c;
            --accent-blue: #234b7a;
            --accent-purple: #5b21b6;
            --accent-orange: #c45000;
            --accent-red: #b71c1c;
            --accent-pink: #880e4f;
            --accent-gold: #b8860b;
            --text-primary: #1a1f2e;
            --text-secondary: #3d4a5c;
            --text-muted: #8494a7;
            --border-color: rgba(27,58,92,0.12);
            --border-glow: rgba(27,58,92,0.2);
            --glass: rgba(255,255,255,0.95);
            --shadow-glow: 0 4px 20px rgba(27,58,92,0.08);
            --container-max-width: 640px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            line-height: 1.7;
            min-height: 100vh;
            display: flex; justify-content: center;
            padding-bottom: 100px;
        }

        body::before {
            content: '';
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 15% 0%, rgba(27,58,92,0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 85% 100%, rgba(184,134,11,0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(35,75,122,0.02) 0%, transparent 70%);
            pointer-events: none; z-index: 0;
        }

        .mobile-container {
            width: 100%; max-width: var(--container-max-width);
            position: relative; z-index: 1;
        }

        .main-header {
            background: linear-gradient(160deg, #0f2440, #1b3a5c, #1f4068);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 2px solid rgba(184,134,11,0.4);
            padding: 12px 10px 10px;
            position: sticky; top: 0; z-index: 100;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 4px 16px rgba(15,36,64,0.3);
        }
        .header-left { display: flex; align-items: center; gap: 10px; }
        .header-logo {
            width: 36px; height: 36px;
            background: linear-gradient(145deg, #d4a017, #b8860b);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; color: #fff;
            box-shadow: 0 3px 0 #8b6508, 0 5px 10px rgba(0,0,0,0.2);
        }
        .header-title { font-size: 1.05rem; font-weight: 800; letter-spacing: -0.5px; color: #fff; }
        .header-title span { color: #f0d060; }
        .version-badge {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(240,208,96,0.15); color: #f0d060;
            padding: 3px 10px; border-radius: 20px; font-size: 0.65rem; font-weight: 700;
            border: 1px solid rgba(240,208,96,0.3);
            cursor: pointer; transition: all 0.3s;
        }
        .version-badge:hover { background: rgba(240,208,96,0.25); }
        .version-badge.dev-active { background: var(--accent-purple); color: #fff; border-color: var(--accent-purple); box-shadow: 0 0 15px var(--accent-purple); }

        .content { padding: 8px; }

        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 12px 10px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(27,58,92,0.06), 0 1px 3px rgba(0,0,0,0.04);
        }
        .section::before {
            content: '';
            position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, #1b3a5c, #b8860b, #1b3a5c, transparent);
            opacity: 0.5;
        }

        .section-title {
            font-weight: 800; font-size: 0.92rem; color: var(--text-primary);
            display: flex; align-items: center; gap: 8px;
            margin-bottom: 12px; padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        .section-title .icon-wrap {
            width: 28px; height: 28px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem;
        }
        .icon-cyan { background: rgba(27,58,92,0.08); color: #1b3a5c; }
        .icon-orange { background: rgba(184,134,11,0.08); color: #b8860b; }
        .icon-purple { background: rgba(91,33,182,0.08); color: var(--accent-purple); }
        .icon-blue { background: rgba(35,75,122,0.08); color: #234b7a; }

        .input-group { margin-bottom: 4px; }
        .input-label {
            display: block; font-weight: 600; font-size: 0.72rem;
            color: var(--text-secondary); margin-bottom: 4px; text-align: center;
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        input[type="text"], input[type="number"], textarea, select {
            width: 100%; padding: 9px 6px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary); font-size: 0.88rem; font-weight: 700;
            transition: all 0.25s;
            text-align: center;
            font-family: 'Noto Sans KR', sans-serif;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #1b3a5c;
            box-shadow: 0 0 0 3px rgba(27,58,92,0.08);
            background: #fff;
        }
        ::placeholder { color: var(--text-muted) !important; font-weight: 400 !important; }
        textarea { resize: none; height: 75px; text-align: left; line-height: 1.5; }

        select {
            -webkit-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 6px center;
            padding-right: 22px;
            text-align-last: center;
        }

        .grid-4 { display: grid; grid-template-columns: 0.6fr 0.9fr 1.2fr 1.5fr; gap: 4px; align-items: end; margin-bottom: 8px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 0.8fr; gap: 4px; align-items: end; margin-bottom: 8px; }
        .grid-3 select { font-size: 0.78rem; letter-spacing: -0.5px; }

        .tdr-input { background: #fff8e1 !important; border-color: #ffb74d !important; color: #e65100 !important; }
        .vap-input { background: #eef1f6 !important; border-color: #a8b5c8 !important; color: #1b3a5c !important; }
        .dew-input { background: #ffebee !important; border-color: #ef9a9a !important; color: #c62828 !important; font-weight: 900; }

        .measure-card {
            background: var(--bg-card-alt);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 10px 8px;
            margin-bottom: 10px;
        }
        .measure-card-title {
            font-size: 0.72rem; color: #1b3a5c; font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 10px; display: flex; align-items: center; gap: 6px;
        }
        .measure-card-title::before {
            content: ''; width: 6px; height: 6px; border-radius: 50%;
            background: #b8860b; display: inline-block;
            box-shadow: 0 0 6px rgba(184,134,11,0.4);
        }

        @keyframes scan-pulse {
            0%, 100% { border-color: var(--border-color); box-shadow: none; }
            50% { border-color: #b8860b; box-shadow: 0 0 12px rgba(184,134,11,0.15); }
        }
        .scanning { animation: scan-pulse 1.2s infinite; }

        .photo-stack { display: flex; flex-direction: column; gap: 10px; }
        .upload-wrapper {
            background: var(--bg-card-alt);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 10px 8px;
            transition: all 0.3s;
        }
        .upload-wrapper.filled { border-color: #1b3a5c; background: #eef1f6; }

        .upload-box {
            border: 2px dashed rgba(27,58,92,0.12);
            background: var(--bg-input);
            border-radius: 10px;
            width: 100%; aspect-ratio: 16/9;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; position: relative; overflow: hidden;
            transition: all 0.3s; margin-bottom: 8px; color: var(--text-muted);
        }
        .upload-box:hover { border-color: #b8860b; background: #fdf8ef; }
        .upload-icon { font-size: 1.6rem; margin-bottom: 6px; opacity: 0.5; }
        .upload-box span { font-size: 0.75rem; }
        .preview-img { width: 100%; height: 100%; object-fit: contain; display: none; background: #000; }
        .file-input { display: none; }

        .upload-type-badge {
            display: inline-flex; align-items: center; gap: 5px;
            font-size: 0.72rem; font-weight: 700;
            padding: 3px 10px; border-radius: 6px;
            margin-bottom: 8px;
        }
        .badge-main { background: #e8edf4; color: #1b3a5c; }
        .badge-uv { background: #ede7f6; color: #4a148c; }
        .badge-thermal { background: #fff3e0; color: #bf360c; }
        .badge-mr277 { background: #e3edf7; color: #234b7a; }
        .badge-mr12 { background: #e0f2f1; color: #004d40; }
        .badge-sonic { background: #fce4ec; color: #880e4f; }

        .add-photo-btn {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(180deg, #f8f9fb 0%, #e4e8ee 100%);
            color: #1b3a5c;
            border: 1px solid #c8ced8;
            border-bottom: 3px solid #a8b0bc;
            border-radius: 10px;
            font-size: 0.75rem; font-weight: 700;
            cursor: pointer; transition: all 0.15s;
            margin-top: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.06);
        }
        .add-photo-btn:hover { background: linear-gradient(180deg, #fff 0%, #eef1f5 100%); }
        .add-photo-btn:active { transform: translateY(2px); border-bottom-width: 1px; box-shadow: none; }

        .legal-box {
            background: #fff8e1;
            border: 1px solid #ffe0b2;
            border-radius: 10px;
            padding: 12px 10px; margin-bottom: 10px;
            font-size: 0.75rem; color: #e65100; line-height: 1.5;
        }
        .legal-check {
            display: flex; align-items: center; margin-top: 12px;
            font-weight: 700; cursor: pointer; color: var(--text-primary);
        }
        .legal-check input { width: 18px; height: 18px; margin-right: 8px; accent-color: #1b3a5c; }

        .analyze-btn {
            width: 100%; padding: 16px;
            background: linear-gradient(180deg, #d0d5de 0%, #b8bfcc 100%);
            color: #8494a7;
            border: 1px solid #b0b8c4;
            border-bottom: 4px solid #959dac;
            border-radius: 14px;
            font-size: 1.05rem; font-weight: 800;
            cursor: not-allowed;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-bottom: 10px;
            transition: all 0.2s;
            font-family: 'Noto Sans KR', sans-serif;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
        }
        .analyze-btn.active {
            background: linear-gradient(180deg, #2a5a8f 0%, #1b3a5c 50%, #0f2440 100%);
            color: #f0d060; cursor: pointer;
            border: 1px solid #0f2440;
            border-bottom: 5px solid #081a30;
            box-shadow: 0 6px 20px rgba(15,36,64,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
            transform: translateY(-1px);
        }
        .analyze-btn.active:hover {
            background: linear-gradient(180deg, #326aa3 0%, #1f4068 50%, #132d4f 100%);
            box-shadow: 0 8px 28px rgba(15,36,64,0.4), inset 0 1px 0 rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }
        .analyze-btn.active:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
            box-shadow: 0 2px 8px rgba(15,36,64,0.2);
        }

        #result-area {
            display: none;
            background: var(--bg-card);
            border: 1px solid rgba(27,58,92,0.2);
            border-radius: 14px;
            padding: 14px 10px;
            margin-top: 14px;
            box-shadow: 0 6px 24px rgba(27,58,92,0.1);
            position: relative;
            overflow: hidden;
        }
        #result-area::before {
            content: '';
            position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, #1b3a5c, #b8860b, #1b3a5c);
        }

        .report-badge {
            background: #eef1f6;
            border: 1px solid #d0d5de;
            border-left: 3px solid #b8860b;
            color: var(--text-secondary);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.73rem; font-weight: 500;
            margin-bottom: 14px; line-height: 1.5;
        }
        .report-badge strong { color: #1b3a5c; }

        .report-gallery {
            display: grid; grid-template-columns: 1fr 1fr; gap: 6px;
            margin-bottom: 14px; padding-bottom: 14px;
            border-bottom: 1px solid var(--border-color);
        }
        .report-img-item {
            border-radius: 10px; overflow: hidden;
            border: 1px solid var(--border-color);
            aspect-ratio: 4/3; background: #000;
            display: flex; flex-direction: column;
        }
        .report-img-item img { width: 100%; height: 100%; object-fit: contain; display: block; }
        .report-img-caption {
            font-size: 0.65rem; padding: 4px 8px; text-align: center;
            background: var(--bg-card-alt); color: var(--text-secondary);
            font-weight: 700; font-family: 'JetBrains Mono', monospace;
        }

        .report-summary-table { width: 100%; border-collapse: collapse; margin-bottom: 14px; font-size: 0.83rem; }
        .report-summary-table tr { border-bottom: 1px solid var(--border-color); }
        .report-summary-table th { padding: 10px 8px; color: var(--text-secondary); width: 35%; text-align: left; font-weight: 500; }
        .report-summary-table td { padding: 10px 8px; font-weight: 700; color: #1b3a5c; }

        .chart-container { position: relative; height: 350px; width: 100%; margin-top: 20px; }

        #analysis-content { font-size: 0.9rem; line-height: 1.8; color: var(--text-primary); }
        #analysis-content h2 {
            font-size: 1rem; font-weight: 800; margin: 28px 0 12px;
            padding: 10px 14px; border-radius: 10px;
            background: #eef1f6;
            border-left: 3px solid #b8860b;
            color: #1b3a5c;
        }
        #analysis-content h3 { font-size: 0.95rem; font-weight: 700; margin: 20px 0 8px; color: #234b7a; }
        #analysis-content p { margin-bottom: 10px; color: var(--text-secondary); }
        #analysis-content strong { color: var(--text-primary); }
        #analysis-content ul, #analysis-content ol { padding-left: 20px; margin-bottom: 12px; color: var(--text-secondary); }
        #analysis-content li { margin-bottom: 6px; }
        #analysis-content code {
            font-family: 'JetBrains Mono', monospace;
            background: #eef1f6; color: #1b3a5c;
            padding: 2px 6px; border-radius: 4px; font-size: 0.82rem;
        }
        #analysis-content blockquote {
            border-left: 3px solid #b8860b;
            padding: 10px 14px; margin: 14px 0;
            background: #fdf8ef; border-radius: 0 8px 8px 0;
            color: #8b6508; font-size: 0.85rem;
        }
        #analysis-content table {
            width: 100%; border-collapse: collapse; margin: 14px 0;
            font-size: 0.82rem;
        }
        #analysis-content table th, #analysis-content table td {
            padding: 8px 10px; border: 1px solid var(--border-color); text-align: left;
        }
        #analysis-content table th { background: #eef1f6; color: #1b3a5c; font-weight: 700; }
        #analysis-content table td { color: var(--text-secondary); }

        @keyframes spin-glow { to { transform: rotate(360deg); } }
        .loading-wrap { text-align: center; padding: 50px 20px; }
        .loading-spinner {
            width: 48px; height: 48px;
            border: 3px solid #d0d5de;
            border-top-color: #1b3a5c;
            border-radius: 50%;
            animation: spin-glow 0.8s linear infinite;
            margin: 0 auto 20px;
        }
        .loading-text { color: var(--text-secondary); font-size: 0.85rem; font-weight: 500; }
        .loading-text strong { color: #1b3a5c; }

        .footer-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 16px; }
        .footer-btn {
            padding: 14px;
            border: none; border-radius: 12px;
            font-size: 0.88rem; font-weight: 700;
            cursor: pointer; color: #fff;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: all 0.15s;
            font-family: 'Noto Sans KR', sans-serif;
            position: relative;
        }
        .btn-call {
            background: linear-gradient(180deg, #d4a017 0%, #b8860b 50%, #8b6508 100%);
            border: 1px solid #8b6508;
            border-bottom: 4px solid #6b4f06;
            box-shadow: 0 4px 10px rgba(139,101,8,0.25), inset 0 1px 0 rgba(255,255,255,0.2);
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .btn-call:hover {
            background: linear-gradient(180deg, #e0b020 0%, #c89410 50%, #96700a 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(139,101,8,0.35), inset 0 1px 0 rgba(255,255,255,0.25);
        }
        .btn-call:active { transform: translateY(2px); border-bottom-width: 1px; box-shadow: 0 1px 4px rgba(0,0,0,0.2); }

        .btn-pdf {
            background: linear-gradient(180deg, #3a6491 0%, #1b3a5c 50%, #0f2440 100%);
            border: 1px solid #0f2440;
            border-bottom: 4px solid #081a30;
            box-shadow: 0 4px 10px rgba(15,36,64,0.25), inset 0 1px 0 rgba(255,255,255,0.1);
            color: #d0dbe8;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .btn-pdf:hover {
            background: linear-gradient(180deg, #4a74a1 0%, #234b7a 50%, #162f50 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(15,36,64,0.35), inset 0 1px 0 rgba(255,255,255,0.15);
            color: #fff;
        }
        .btn-pdf:active { transform: translateY(2px); border-bottom-width: 1px; box-shadow: 0 1px 4px rgba(0,0,0,0.2); }

        .footer-info { text-align: center; margin-top: 30px; padding: 20px; color: var(--text-muted); font-size: 0.75rem; }

        .status-dot {
            width: 6px; height: 6px; border-radius: 50%;
            display: inline-block;
            background: #b8860b;
            box-shadow: 0 0 6px rgba(184,134,11,0.5);
            animation: blink 2s infinite;
        }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

        .ref-card {
            background: #ffebee;
            border: 1px solid #ef9a9a;
            border-radius: 8px; padding: 8px 12px;
            font-size: 0.73rem; color: #c62828;
            text-align: center; margin-bottom: 12px;
            font-weight: 600;
        }

        .hint-text {
            font-size: 0.68rem; color: var(--text-muted);
            margin-top: 4px; text-align: right;
        }
        .hint-text.center { text-align: center; }

        /* Auto-fill success indicator */
        @keyframes autofill-success {
            0% { box-shadow: 0 0 0 0 rgba(76,175,80,0.4); }
            70% { box-shadow: 0 0 0 8px rgba(76,175,80,0); }
            100% { box-shadow: 0 0 0 0 rgba(76,175,80,0); }
        }
        .autofill-success {
            animation: autofill-success 0.8s ease-out;
            border-color: #4caf50 !important;
            background: #e8f5e9 !important;
        }

        @media (max-width: 640px) {
            body { padding-bottom: 60px; }
            .content { padding: 6px; }
            .section { padding: 10px 8px; border-radius: 10px; margin-bottom: 8px; }
            .measure-card { padding: 8px 6px; }
            .upload-wrapper { padding: 8px 6px; }
            .grid-4 { gap: 3px; }
            .grid-3 { gap: 3px; }
            .grid-3 select { font-size: 0.75rem; }
            #result-area { padding: 12px 8px; border-radius: 12px; }
            .section-title { font-size: 0.9rem; margin-bottom: 12px; padding-bottom: 8px; }
            .legal-box { padding: 10px 8px; }
            .footer-btns { gap: 6px; margin-top: 12px; }
            .footer-btn { padding: 12px; font-size: 0.82rem; }
        }

        @media print {
            body { background: #fff; color: #000; }
            .mobile-container { box-shadow: none; max-width: 100%; }
            .no-print { display: none !important; }
            #result-area { display: block !important; border: 2px solid #000; background: #fff; color: #000; }
            #analysis-content, #analysis-content h2, #analysis-content h3, #analysis-content p,
            #analysis-content li, #analysis-content td, #analysis-content strong { color: #000 !important; }
            .report-summary-table td { color: #000 !important; }
        }
    </style>
</head>
<body>

<div class="mobile-container">
    <header class="main-header">
        <div class="header-left">
            <div class="header-logo"><i class="fas fa-microscope"></i></div>
            <div class="header-title"><span>ì²­ê°œêµ¬ë¦¬</span> ê²°ë¡œì§„ë‹¨ AI</div>
        </div>
        <span class="version-badge" id="version-badge" onclick="checkDevMode()">v27.0 PRO</span>
    </header>

    <div class="content">

        <!-- â”€â”€â”€â”€â”€ 1. ì§„ë‹¨ ê°œìš” â”€â”€â”€â”€â”€ -->
        <div class="section no-print">
            <div class="section-title">
                <div class="icon-wrap icon-cyan"><i class="fas fa-home"></i></div>
                ì§„ë‹¨ ê°œìš”
            </div>
            <div class="grid-4">
                <div class="input-group"><label class="input-label">ë™</label><input type="text" id="dong" placeholder="101"></div>
                <div class="input-group"><label class="input-label">í˜¸</label><input type="text" id="ho" placeholder="1204"></div>
                <div class="input-group"><label class="input-label">ì¥ì†Œ</label><input type="text" id="location" placeholder="ê±°ì‹¤ì°½"></div>
                <div class="input-group"><label class="input-label">ì¼ì</label><input type="text" id="date" style="color:var(--accent-cyan);"></div>
            </div>
            <div class="grid-3">
                <div class="input-group">
                    <label class="input-label">ì°½í˜¸ ì‚¬ì–‘</label>
                    <select id="window-type">
                        <option value="PVC ì´ì¤‘ì°½">PVC ì´ì¤‘ì°½ (ì¼ë°˜)</option>
                        <option value="ì…ë©´ë¶„í• ì°½">ì…ë©´ë¶„í• ì°½ (ê³ ê¸‰í˜•)</option>
                        <option value="PVC ì‹œìŠ¤í…œì°½í˜¸">PVC ì‹œìŠ¤í…œì°½í˜¸ (TT/LS)</option>
                        <option value="ì•Œë£¨ë¯¸ëŠ„ ë‹¨ì°½">ì•Œë£¨ë¯¸ëŠ„ ë‹¨ì°½ (ë…¸í›„)</option>
                        <option value="ì»¤íŠ¼ì›”(Curtain Wall)">ì»¤íŠ¼ì›” (ì£¼ìƒë³µí•©)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">êµ¬ì¡° íŠ¹ì„±</label>
                    <select id="house-type">
                        <option value="í™•ì¥í˜•(Extension)">ë°œì½”ë‹ˆ í™•ì¥í˜•</option>
                        <option value="ë¹„í™•ì¥(Non-Ext)">ë¹„í™•ì¥ (ê¸°ë³¸í˜•)</option>
                        <option value="í•„ë¡œí‹°/ìµœìƒì¸µ">í•„ë¡œí‹°/ìµœìƒì¸µ</option>
                        <option value="ì¸¡ë²½ì„¸ëŒ€">ì¸¡ë²½ ì„¸ëŒ€ (End)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">ê³ ë ¤ì‚¬í•­</label>
                    <select id="consideration">
                        <option value="ì•Œë£¨ë¯¸ëŠ„ ê°„ë´‰">ì•Œë£¨ë¯¸ëŠ„ ê°„ë´‰</option>
                        <option value="TPS ë‹¨ì—´ê°„ë´‰">TPS ë‹¨ì—´ê°„ë´‰</option>
                        <option value="TGI ë‹¨ì—´ê°„ë´‰">TGI ë‹¨ì—´ê°„ë´‰</option>
                    </select>
                </div>
            </div>
            <div class="input-group">
                <textarea id="defect-content" placeholder="[ìƒì„¸ ì¦ìƒ] ì˜ˆ: ì•„ì¹¨ë§ˆë‹¤ ìœ ë¦¬ì°½ í•˜ë‹¨ì— ë¬¼ì´ ê³ ì„, ë¶ìª½ ë°© ëª¨ì„œë¦¬ì— ê²€ì€ ê³°íŒ¡ì´ ë°œìƒ ë“±"></textarea>
            </div>
        </div>

        <!-- â”€â”€â”€â”€â”€ 2. ì •ë°€ ê³„ì¸¡ â”€â”€â”€â”€â”€ -->
        <div class="section no-print">
            <div class="section-title">
                <div class="icon-wrap icon-orange"><i class="fas fa-temperature-high"></i></div>
                ì •ë°€ ê³„ì¸¡ ë°ì´í„°
                <div class="status-dot" style="margin-left:auto;"></div>
            </div>

            <div class="measure-card">
                <div class="measure-card-title">ì‹¤ë‚´ í™˜ê²½ & ë…¸ì  ì˜¨ë„</div>
                <div style="display:grid; grid-template-columns:1fr 1fr 1.4fr; gap:8px;">
                    <div class="input-group">
                        <label class="input-label">ì‹¤ë‚´ì˜¨ë„(Ti)</label>
                        <input type="number" id="temp-in" placeholder="MR277 Auto" oninput="calcDewPoint()">
                    </div>
                    <div class="input-group">
                        <label class="input-label">ìƒëŒ€ìŠµë„(RH)</label>
                        <input type="number" id="humid-in" placeholder="MR277 Auto" oninput="calcDewPoint()">
                    </div>
                    <div class="input-group">
                        <label class="input-label">ğŸ”¥ ë…¸ì ì˜¨ë„(Tdp)</label>
                        <input type="text" id="dew-result" placeholder="ìë™ê³„ì‚°" readonly class="dew-input">
                    </div>
                </div>
            </div>

            <div class="measure-card">
                <div class="measure-card-title">í‘œë©´ & ì™¸ê¸° ì˜¨ë„</div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div class="input-group">
                        <label class="input-label">ğŸ“‰ í‘œë©´ì˜¨ë„(Tsi)</label>
                        <input type="number" id="temp-surf" class="tdr-input" placeholder="MR12 Auto">
                        <div class="hint-text center">* MR12 ë³¼í”„ë¡œë¸Œ ë˜ëŠ” ì—´í™”ìƒ ìë™ì…ë ¥</div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">ì™¸ê¸°ì˜¨ë„(To)</label>
                        <input type="text" id="temp-out" placeholder="Loading.." style="background:var(--bg-card-alt);">
                    </div>
                </div>
            </div>

            <div class="measure-card">
                <div class="measure-card-title"><i class="fas fa-wind" style="margin-right:4px;"></i> ê³µê¸°ì§ˆ ì •ë°€ ì§„ë‹¨</div>
                <div class="ref-card">â€» ê²¨ìš¸ì²  ì ì •(ì‹ ì¶•): VAP 1.2kPa â†“ / MIX 7.3g/kg â†“</div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div class="input-group">
                        <label class="input-label">VAP (ìˆ˜ì¦ê¸°ì••)</label>
                        <input type="number" id="vap-val" class="vap-input" placeholder="MR277 Auto" step="0.01">
                    </div>
                    <div class="input-group">
                        <label class="input-label">MIX (ì ˆëŒ€ìŠµë„)</label>
                        <input type="number" id="mix-val" class="vap-input" placeholder="MR277 Auto" step="0.01">
                    </div>
                </div>
                <div class="hint-text">* MR277 ì‚¬ì§„ ë“±ë¡ ì‹œ ìë™ ì…ë ¥ë¨</div>
            </div>
        </div>

        <!-- â”€â”€â”€â”€â”€ 3. í˜„ì¥ ì±„ì¦ â”€â”€â”€â”€â”€ -->
        <div class="section no-print">
            <div class="section-title">
                <div class="icon-wrap icon-purple"><i class="fas fa-images"></i></div>
                í˜„ì¥ ì±„ì¦
            </div>
            <div class="photo-stack" id="photo-container">

                <div class="upload-wrapper" id="wrap-1">
                    <div class="upload-type-badge badge-main"><i class="fas fa-camera"></i> 1. ê²°ë¡œ/ê³°íŒ¡ì´ ë©”ì¸ (í•„ìˆ˜)</div>
                    <label for="img-1" class="upload-box">
                        <i class="fas fa-camera upload-icon"></i>
                        <span>í„°ì¹˜í•˜ì—¬ ì‚¬ì§„ ì´¬ì˜/ì„ íƒ</span>
                        <img id="view-1" class="preview-img">
                    </label>
                    <input type="file" id="img-1" class="file-input" accept="image/*" onchange="handleImage(this)">
                    <button class="add-photo-btn" onclick="addPhotoInput(this, 'ì¶”ê°€ ì‚¬ì§„')"><i class="fas fa-plus"></i> ì‚¬ì§„ ì¶”ê°€</button>
                </div>

                <div class="upload-wrapper">
                    <div class="upload-type-badge badge-uv"><i class="fas fa-lightbulb"></i> 2. UV í˜•ê´‘ ì´¬ì˜</div>
                    <label for="img-uv" class="upload-box">
                        <i class="fas fa-lightbulb upload-icon" style="color:var(--accent-purple);"></i>
                        <span>UV í˜•ê´‘ ì´ë¯¸ì§€</span>
                        <img id="view-uv" class="preview-img">
                    </label>
                    <input type="file" id="img-uv" class="file-input" accept="image/*" onchange="handleImage(this)">
                </div>

                <div class="upload-wrapper">
                    <div class="upload-type-badge badge-thermal"><i class="fas fa-temperature-high"></i> 3. ì—´í™”ìƒ ì¹´ë©”ë¼</div>
                    <label for="img-thermal" class="upload-box">
                        <i class="fas fa-temperature-high upload-icon" style="color:var(--accent-orange);"></i>
                        <span>ì—´í™”ìƒ ì´ë¯¸ì§€</span>
                        <img id="view-thermal" class="preview-img">
                    </label>
                    <input type="file" id="img-thermal" class="file-input" accept="image/*" onchange="handleImage(this); autoFillFromImage(this, 'thermal')">
                    <button class="add-photo-btn" onclick="addPhotoInput(this, 'ì—´í™”ìƒ')"><i class="fas fa-plus"></i> ì‚¬ì§„ ì¶”ê°€</button>
                </div>

                <div class="upload-wrapper">
                    <div class="upload-type-badge badge-mr277"><i class="fas fa-ruler-combined"></i> 4. FLIR MR277 (VAP ê³„ì¸¡)</div>
                    <label for="img-mr277" class="upload-box">
                        <i class="fas fa-ruler-combined upload-icon" style="color:var(--accent-blue);"></i>
                        <span>MR277 í™”ë©´ â†’ Ti, RH, VAP, MIX ìë™ì…ë ¥</span>
                        <img id="view-mr277" class="preview-img">
                    </label>
                    <input type="file" id="img-mr277" class="file-input" accept="image/*" onchange="handleImage(this); autoFillFromImage(this, 'mr277')">
                    <button class="add-photo-btn" onclick="addPhotoInput(this, 'MR277')"><i class="fas fa-plus"></i> ì‚¬ì§„ ì¶”ê°€</button>
                </div>

                <div class="upload-wrapper">
                    <div class="upload-type-badge badge-mr12"><i class="fas fa-bullseye"></i> 5. FLIR MR12 ë³¼ í”„ë¡œë¸Œ â†’ í‘œë©´ì˜¨ë„(Tsi) ìë™ì…ë ¥</div>
                    <label for="img-mr12" class="upload-box">
                        <i class="fas fa-bullseye upload-icon" style="color:var(--accent-cyan);"></i>
                        <span>ë³¼ í”„ë¡œë¸Œ ì¸¡ì • í™”ë©´ â†’ Tsi ìë™ì…ë ¥</span>
                        <img id="view-mr12" class="preview-img">
                    </label>
                    <input type="file" id="img-mr12" class="file-input" accept="image/*" onchange="handleImage(this); autoFillFromImage(this, 'mr12')">
                    <button class="add-photo-btn" onclick="addPhotoInput(this, 'ë³¼ í”„ë¡œë¸Œ')"><i class="fas fa-plus"></i> ì‚¬ì§„ ì¶”ê°€</button>
                </div>

                <div class="upload-wrapper">
                    <div class="upload-type-badge badge-sonic"><i class="fas fa-wave-square"></i> 6. ì´ˆìŒíŒŒ ìŒí–¥ ì¹´ë©”ë¼</div>
                    <label for="img-sonic" class="upload-box">
                        <i class="fas fa-wave-square upload-icon" style="color:var(--accent-pink);"></i>
                        <span>ìŒí–¥ ì¹´ë©”ë¼ ì´ë¯¸ì§€</span>
                        <img id="view-sonic" class="preview-img">
                    </label>
                    <input type="file" id="img-sonic" class="file-input" accept="image/*" onchange="handleImage(this)">
                    <button class="add-photo-btn" onclick="addPhotoInput(this, 'ì´ˆìŒíŒŒ')"><i class="fas fa-plus"></i> ì‚¬ì§„ ì¶”ê°€</button>
                </div>
            </div>
        </div>

        <!-- â”€â”€â”€â”€â”€ Legal & Analyze â”€â”€â”€â”€â”€ -->
        <div class="legal-box no-print">
            <strong>[ë¶„ì„ ì „ í•„ìˆ˜ ë™ì˜]</strong><br>
            ë³¸ ë¦¬í¬íŠ¸ëŠ” <strong>ê³µê°œëœ ê±´ì¶•ë¬¼ë¦¬ í‘œì¤€ ë°ì´í„°(TDR, Dew Point ë“±)</strong>ë¥¼ ê¸°ë°˜ìœ¼ë¡œ AIê°€ ìƒì„±í•œ 'ì°¸ê³ ìš© ê¸°ìˆ  ì†Œê²¬'ì…ë‹ˆë‹¤. 'ê¸°ìˆ ì‚¬ë²•'ì— ì˜í•œ ê³µì¸ ê°ì •ì„œê°€ ì•„ë‹ˆë©°, ë²•ì  ë¶„ìŸì˜ ì¦ê±°ë¡œ íš¨ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.
            <label class="legal-check">
                <input type="checkbox" id="legal-agree" onchange="toggleAnalyzeBtn()">
                ìœ„ ë‚´ìš©ì„ í™•ì¸í•˜ì˜€ìœ¼ë©° ë™ì˜í•©ë‹ˆë‹¤.
            </label>
        </div>

        <button class="analyze-btn no-print" id="analyze-btn" onclick="startAnalysis()" disabled>
            <i class="fas fa-bolt"></i> AI ì •ë°€ ë¶„ì„ ì‹œì‘
        </button>

        <!-- â”€â”€â”€â”€â”€ Result Area â”€â”€â”€â”€â”€ -->
        <div id="result-area">
            <div class="section-title" style="margin-top:0;">
                <div class="icon-wrap icon-cyan"><i class="fas fa-file-signature"></i></div>
                ê²°ë¡œ ì •ë°€ ì§„ë‹¨ ì†Œê²¬ì„œ
            </div>

            <div class="report-badge">
                <i class="fas fa-check-circle"></i>
                ë³¸ ê²°ê³¼ëŠ” <strong>ê±´ì¶• ë¬¼ë¦¬ í‘œì¤€ ë°ì´í„° ë° í•˜ì ì‚¬ë¡€ ë¹…ë°ì´í„°</strong>ë¥¼ ê·¼ê±°ë¡œ TDR(ì˜¨ë„ì°¨ì´ë¹„ìœ¨) ë° VAP/MIX(ê³µê¸°ì§ˆ) ë¶„ì„ì„ ìˆ˜í–‰í•œ ê²°ê³¼ì…ë‹ˆë‹¤.
                <br><strong>Gemini 2.5 Flash</strong> ëª¨ë¸ ê¸°ë°˜ ì „ë¬¸ ë¶„ì„.
            </div>

            <div style="font-size:0.75rem; color:var(--text-secondary); margin-bottom:8px; font-weight:600;">[í˜„ì¥ ì±„ì¦ ë°ì´í„°]</div>
            <div id="report-photo-gallery" class="report-gallery"></div>

            <table class="report-summary-table">
                <tr><th>ì§„ë‹¨ ì¼ì</th><td id="rep-date"></td></tr>
                <tr><th>ì§„ë‹¨ ëŒ€ìƒ</th><td id="rep-loc"></td></tr>
                <tr><th>êµ¬ì¡°/ì‚¬ì–‘</th><td id="rep-type"></td></tr>
            </table>

            <div id="loading-spinner" class="loading-wrap" style="display:none;">
                <div class="loading-spinner"></div>
                <div class="loading-text">
                    <strong>Gemini 2.5 Flash</strong> ë¶„ì„ ì¤‘...<br>
                    ê±´ì¶• ë¬¼ë¦¬ ë°ì´í„° ëŒ€ì¡° ë° ì›ì¸ íŒë³„
                </div>
            </div>

            <div id="analysis-content"></div>

            <div id="chart-section" style="display:none; margin-top:30px; border-top:1px solid var(--border-color); padding-top:20px;">
                <div class="section-title">
                    <div class="icon-wrap icon-blue"><i class="fas fa-chart-pie"></i></div>
                    ì›ì¸ ê·€ì±… ì‚¬ìœ  (ì¶”ì •)
                </div>
                <div id="chart_div" class="chart-container"></div>
                <div style="margin-top:24px; font-size:0.68rem; color:var(--text-muted); text-align:center; border:1px solid var(--border-color); padding:10px; border-radius:8px;">
                    â€» ë³¸ ë¬¸ì„œëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ê°€ ì‘ì„±í•œ ë¹„ê³µì‹ ì†Œê²¬ì„œì…ë‹ˆë‹¤. ë²•ì  íš¨ë ¥ì´ ì—†ìœ¼ë©°, ì •í™•í•œ ì›ì¸ ê·œëª…ì„ ìœ„í•´ì„œëŠ” ì „ë¬¸ ê¸°ìˆ ì‚¬ì˜ í˜„ì¥ ì •ë°€ ì§„ë‹¨ì´ í•„ìš”í•©ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer-btns no-print">
            <button class="footer-btn btn-call" onclick="window.location.href='tel:01023220949'">
                <i class="fas fa-phone-alt"></i> ê¸°ìˆ  ìƒë‹´
            </button>
            <button class="footer-btn btn-pdf" onclick="savePdf()">
                <i class="fas fa-file-download"></i> PDF ì €ì¥
            </button>
        </div>
        <div class="footer-info no-print">
            <p><strong>ì²­ê°œêµ¬ë¦¬ìƒ¤ì‹œ</strong> Â· ë°ì´í„° ê¸°ë°˜ ê²°ë¡œ ì†”ë£¨ì…˜</p>
        </div>
    </div>
</div>

<script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
    google.charts.load("current", {packages:["corechart"]});
    const API_KEY = "AIzaSyCVgdFT-YkZYlmx" + "cnQ8-rAgejDjRzFK" + "6ns";

    const today = new Date();
    const dateStr = `${today.getFullYear()}.${today.getMonth()+1}.${today.getDate()}`;
    document.getElementById('date').value = dateStr;

    let clickCount = 0; let clickTimer;
    window.checkDevMode = function() {
        clearTimeout(clickTimer); clickCount++;
        if(clickCount === 5) {
            const badge = document.getElementById('version-badge');
            if(badge.classList.contains('dev-active')) { badge.classList.remove('dev-active'); alert("ê°œë°œì ëª¨ë“œ í•´ì œ"); }
            else { badge.classList.add('dev-active'); alert("ğŸ¸ ê°œë°œì ëª¨ë“œ í™œì„±í™”!"); }
            clickCount = 0;
        }
        clickTimer = setTimeout(() => { clickCount = 0; }, 1000);
    };

    const CONDENSATION_DB = [
        {
            id: "C-001", category: "êµ¬ì¡°ì²´(Structure)",
            diagnosis: "ê¸°í•˜í•™ì  ì—´êµ (Geometric Thermal Bridge)",
            mechanism: "ê±´ë¬¼ ì½”ë„ˆ ë¶€ìœ„ëŠ” ì™¸ë¶€ ë°©ì—´ ë©´ì ì´ ë‚´ë¶€ í¡ì—´ ë©´ì ë³´ë‹¤ ë„“ì–´ êµ¬ì¡°ì ìœ¼ë¡œ ì˜¨ë„ê°€ ê°€ì¥ ë‚®ìŠµë‹ˆë‹¤. í•´ë‹¹ ë¶€ìœ„ì˜ TDR(ì˜¨ë„ì°¨ì´ë¹„ìœ¨)ì´ ê¸°ì¤€ì¹˜ë¥¼ ì´ˆê³¼í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.",
            solution: "1. ê°€êµ¬ì™€ ë²½ì²´ ì‚¬ì´ 10cm ì´ìƒ ì´ê²©\n2. ì‹¤ë‚´ ìŠµë„ 45% ì´í•˜ ê´€ë¦¬\n3. [ì‹œê³µ] ì½”ë„ˆ ë¶€ìœ„ ë‹¨ì—´ì¬ ê¸°ë°€ ë§ëŒ"
        },
        {
            id: "C-002", category: "ì°½í˜¸(Window)",
            diagnosis: "ê°„ë´‰(Spacer) ì—´êµ ë° í”„ë ˆì„ ë‹¨ì—´ ì„±ëŠ¥ ë¶€ì¡±",
            mechanism: "ë³µì¸µ ìœ ë¦¬ í…Œë‘ë¦¬ì˜ ì•Œë£¨ë¯¸ëŠ„ ê°„ë´‰ì´ ì™¸ë¶€ ëƒ‰ê¸°ë¥¼ ì‹¤ë‚´ë¡œ ì „ë‹¬í•˜ëŠ” 'ì„ í˜• ì—´êµ' í˜„ìƒì…ë‹ˆë‹¤.",
            solution: "1. ì»¤íŠ¼/ë¸”ë¼ì¸ë“œ í•˜ë‹¨ 10cm ë„ì›Œ í†µê¸°\n2. ì°½í˜¸ ë¬¼êµ¬ë© ë°©í’ìº¡ ì„¤ì¹˜\n3. ë‹¨ì—´ ê°„ë´‰(TPS) Low-E ìœ ë¦¬ êµì²´"
        },
        {
            id: "C-003", category: "ê¸°ë°€(Airtightness)",
            diagnosis: "ì¹¨ê¸°(Infiltration)ì— ì˜í•œ ë‚´ë¶€ ê²°ë¡œ",
            mechanism: "ê¸°ë°€ì¸µ íŒŒê´´ í‹ˆìƒˆë¡œ ì™¸ë¶€ ì°¨ê°€ìš´ ê³µê¸°ê°€ ì¹¨íˆ¬í•˜ì—¬ ë²½ì²´ ë‚´ë¶€ ì˜¨ë„ë¥¼ ë‚®ì¶”ê³  ìŠµê¸°ë¥¼ ì‘ê²°ì‹œí‚µë‹ˆë‹¤.",
            solution: "1. ì „ì„ ê´€ ì£¼ë³€ ê¸°ë°€ í…Œì´í”„/ìš°ë ˆíƒ„ í¼ ì¶©ì§„\n2. ì—ì–´ì»¨ ë°°ê´€ êµ¬ë© ì‹¤ë¦¬ì½˜ ì¬ë§ˆê°\n3. ë°©í’ ì»¤ë²„ ì„¤ì¹˜"
        },
        {
            id: "C-004", category: "í™˜ê¸°(Ventilation)",
            diagnosis: "í™˜ê¸° ë¶€ì¡±ì— ì˜í•œ ì‹¤ë‚´ ìŠµê¸° ê³¼ë‹¤ ì¶•ì ",
            mechanism: "ë°€íëœ ì‹¤ë‚´ì—ì„œ ì·¨ì‚¬Â·ì„¸íƒÂ·í˜¸í¡ ë“±ìœ¼ë¡œ ë°œìƒí•œ ìˆ˜ì¦ê¸°ê°€ ë°°ì¶œë˜ì§€ ëª»í•˜ê³  ì¶•ì ë˜ì–´ ë…¸ì ì˜¨ë„ ì´ìƒì˜ ìŠµë„ë¥¼ í˜•ì„±í•©ë‹ˆë‹¤. VAP > 1.2kPa, MIX > 7.3g/kgì¼ ë•Œ í™˜ê¸° ë¶€ì¡±ì´ ì£¼ ì›ì¸ì…ë‹ˆë‹¤.",
            solution: "1. í•˜ë£¨ 3íšŒ ì´ìƒ ë§í†µí’ 10ë¶„ í™˜ê¸°\n2. ìš•ì‹¤Â·ì£¼ë°© í™˜ê¸°íŒ¬ ìƒì‹œ ê°€ë™\n3. ì „ì—´êµí™˜ê¸°(HRV/ERV) ì„¤ì¹˜ ê¶Œì¥\n4. ì œìŠµê¸° ê°€ë™ (ëª©í‘œ ìŠµë„ 40-45%)"
        },
        {
            id: "C-005", category: "ì‹œê³µ(Construction)",
            diagnosis: "ì´ˆê¸° ê±´ì¶•ë¬¼ ìŠµê¸°(Construction Moisture) ë°©ì¶œ",
            mechanism: "ì½˜í¬ë¦¬íŠ¸ ë° ëª¨ë¥´íƒ€ë¥´ ì–‘ìƒ ê³¼ì •ì—ì„œ 1~2ë…„ê°„ ë‹¤ëŸ‰ì˜ ìˆ˜ë¶„ì´ ì§€ì† ë°©ì¶œë©ë‹ˆë‹¤. ì…ì£¼ 2ë…„ ì´ë‚´ ì‹ ì¶• ì•„íŒŒíŠ¸ì—ì„œ íŠ¹íˆ ë¹ˆë²ˆí•©ë‹ˆë‹¤.",
            solution: "1. ì…ì£¼ ì´ˆê¸° 2ë…„ê°„ ì ê·¹ì  í™˜ê¸°\n2. ì œìŠµê¸° ë³‘í–‰ ì‚¬ìš©\n3. ë²½ì§€ ì‹œê³µ ì „ ë°©ìŠµ í”„ë¼ì´ë¨¸ ë„í¬ í™•ì¸"
        }
    ];

    // ì™¸ê¸° ì˜¨ë„ ìë™ ê°€ì ¸ì˜¤ê¸°
    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (pos) => {
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&current=temperature_2m&timezone=auto`;
                const res = await fetch(url);
                if(res.ok) {
                    const data = await res.json();
                    document.getElementById('temp-out').value = data.current.temperature_2m.toFixed(1);
                }
            } catch(e) {}
        });
    }

    window.calcDewPoint = function() {
        const t = parseFloat(document.getElementById('temp-in').value);
        const h = parseFloat(document.getElementById('humid-in').value);
        if(!isNaN(t) && !isNaN(h)) {
            const a = 17.27, b = 237.7;
            const alpha = ((a*t)/(b+t)) + Math.log(h/100.0);
            const dp = (b*alpha)/(a-alpha);
            document.getElementById('dew-result').value = dp.toFixed(1) + "Â°C";
        }
    }

    window.handleImage = function(input) {
        if(input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const wrapper = input.closest('.upload-wrapper');
                const img = wrapper.querySelector('.preview-img');
                const box = wrapper.querySelector('.upload-box');
                img.src = e.target.result;
                img.style.display = 'block';
                box.querySelectorAll('i, span').forEach(el => el.style.display = 'none');
                wrapper.classList.add('filled');
            };
            reader.readAsDataURL(input.files[0]);
        }
    };

    // â”€â”€ ìë™ì…ë ¥ ì„±ê³µ ì‹œ ì‹œê°ì  í”¼ë“œë°± â”€â”€
    function showAutoFillSuccess(elementId, value) {
        const el = document.getElementById(elementId);
        if(el && value !== undefined && value !== null) {
            el.value = value;
            el.classList.remove('scanning');
            el.classList.add('autofill-success');
            setTimeout(() => el.classList.remove('autofill-success'), 1500);
        }
    }

    window.autoFillFromImage = async function(input, type) {
        if(!input.files || !input.files[0]) return;

        // ê° íƒ€ì…ë³„ ëŒ€ìƒ í•„ë“œ ì§€ì •
        let targetIds = [];
        if(type === 'mr277') {
            targetIds = ['temp-in','humid-in','vap-val','mix-val'];
        } else if(type === 'thermal') {
            targetIds = ['temp-surf'];
        } else if(type === 'mr12') {
            targetIds = ['temp-surf'];
        }

        targetIds.forEach(id => {
            document.getElementById(id).classList.add('scanning');
            document.getElementById(id).value = '';
            document.getElementById(id).placeholder = "AI Scanning...";
        });

        try {
            const file = input.files[0];
            const reader = new FileReader();
            const base64Promise = new Promise((resolve) => {
                reader.onload = (e) => resolve(e.target.result.split(',')[1]);
                reader.readAsDataURL(file);
            });
            const base64Data = await base64Promise;
            const genAI = new GoogleGenerativeAI(API_KEY);
            const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash" });

            let prompt = "";
            if(type === 'mr277') {
                prompt = `You are analyzing a FLIR MR277 moisture meter instrument screen photo.
                    Extract ALL numerical values visible on the screen:
                    1. Temperature (Air temperature, labeled as AIR, T, or Â°C) - this is the indoor room temperature
                    2. Relative Humidity (labeled as RH, %) 
                    3. Vapor Pressure (labeled as VAP, in kPa)
                    4. Mixing Ratio (labeled as MIX, in g/kg or GPP)
                    
                    Also look for DEW point temperature if visible.
                    
                    IMPORTANT: Read the numbers carefully from the instrument display.
                    Return ONLY a JSON object with no other text:
                    {"temp": number, "humid": number, "vap": number, "mix": number}
                    
                    If a value is not visible, use null for that field.`;
            } else if(type === 'thermal') {
                prompt = `You are analyzing a thermal camera (infrared) image.
                    Find the MINIMUM temperature value shown in the image.
                    Look for labels like: Lo, Min, minimum, or the lowest temperature in the color scale.
                    Also check for any cursor/crosshair temperature readings.
                    
                    Return ONLY a JSON object with no other text:
                    {"min_temp": number}`;
            } else if(type === 'mr12') {
                prompt = `You are analyzing a FLIR MR12 ball probe (ë³¼ í”„ë¡œë¸Œ) or surface temperature measurement device screen.
                    This device measures SURFACE TEMPERATURE of walls, windows, floors etc.
                    
                    Extract the surface temperature reading from the display.
                    Look for:
                    - The main large temperature number on screen
                    - Any value labeled as surface temp, Tsi, T, or Â°C
                    - If multiple readings exist, extract the primary/main displayed temperature
                    
                    Return ONLY a JSON object with no other text:
                    {"surface_temp": number}`;
            }

            const result = await model.generateContent({
                contents: [{ parts: [{ text: prompt }, { inline_data: { mime_type: file.type, data: base64Data } }] }]
            });
            const response = await result.response;
            const text = response.text();
            const jsonMatch = text.match(/\{[\s\S]*\}/);

            if(jsonMatch) {
                const data = JSON.parse(jsonMatch[0]);

                if(type === 'mr277') {
                    if(data.temp != null) showAutoFillSuccess('temp-in', data.temp);
                    if(data.humid != null) showAutoFillSuccess('humid-in', data.humid);
                    if(data.vap != null) showAutoFillSuccess('vap-val', data.vap);
                    if(data.mix != null) showAutoFillSuccess('mix-val', data.mix);
                    calcDewPoint();
                } else if(type === 'thermal') {
                    if(data.min_temp != null) showAutoFillSuccess('temp-surf', data.min_temp);
                } else if(type === 'mr12') {
                    if(data.surface_temp != null) showAutoFillSuccess('temp-surf', data.surface_temp);
                }
            }
        } catch(e) {
            console.error('Auto-fill error:', e);
            targetIds.forEach(id => {
                document.getElementById(id).placeholder = "ì§ì ‘ ì…ë ¥";
            });
        } finally {
            targetIds.forEach(id => document.getElementById(id).classList.remove('scanning'));
        }
    };

    window.addPhotoInput = function(btnElement, labelText) {
        const wrapper = btnElement.closest('.upload-wrapper');
        const container = document.getElementById('photo-container');
        const newDiv = document.createElement('div');
        newDiv.className = 'upload-wrapper';
        newDiv.style.marginTop = '10px';
        const uid = Date.now();
        newDiv.innerHTML = `<div class="upload-type-badge badge-main"><i class="fas fa-plus-circle"></i> ${labelText} (ì¶”ê°€)</div><label for="img-${uid}" class="upload-box"><i class="fas fa-plus upload-icon"></i><img id="view-${uid}" class="preview-img"></label><input type="file" id="img-${uid}" class="file-input" accept="image/*" onchange="handleImage(this)"><button class="add-photo-btn" onclick="addPhotoInput(this, '${labelText}')"><i class="fas fa-plus"></i> ì‚¬ì§„ ì¶”ê°€</button>`;
        if(wrapper.nextSibling) container.insertBefore(newDiv, wrapper.nextSibling); else container.appendChild(newDiv);
    };

    window.toggleAnalyzeBtn = function() {
        const chk = document.getElementById('legal-agree');
        const btn = document.getElementById('analyze-btn');
        btn.disabled = !chk.checked;
        if(chk.checked) btn.classList.add('active'); else btn.classList.remove('active');
    };

    window.savePdf = function() { window.print(); };

    window.startAnalysis = async function() {
        const loading = document.getElementById('loading-spinner');
        const resultArea = document.getElementById('result-area');
        const contentDiv = document.getElementById('analysis-content');
        const chartSection = document.getElementById('chart-section');
        const gallery = document.getElementById('report-photo-gallery');

        const tempIn = document.getElementById('temp-in').value || 20;
        const tempOut = document.getElementById('temp-out').value || -5;
        const tempSurf = document.getElementById('temp-surf').value;
        const humid = document.getElementById('humid-in').value;
        const dew = document.getElementById('dew-result').value;
        const defect = document.getElementById('defect-content').value;
        const winType = document.getElementById('window-type').value;
        const houseType = document.getElementById('house-type').value;
        const consideration = document.getElementById('consideration').value;
        const vapVal = document.getElementById('vap-val').value;
        const mixVal = document.getElementById('mix-val').value;

        document.getElementById('rep-date').innerText = document.getElementById('date').value;
        document.getElementById('rep-loc').innerText = `${document.getElementById('dong').value}ë™ ${document.getElementById('ho').value}í˜¸ (${document.getElementById('location').value})`;
        document.getElementById('rep-type').innerText = `${winType} / ${houseType} / ${consideration}`;

        let imageParts = [];
        gallery.innerHTML = '';
        document.querySelectorAll('.preview-img').forEach((img, idx) => {
            if(img.src.startsWith('data:image')) {
                imageParts.push({ inline_data: { mime_type: "image/jpeg", data: img.src.split(',')[1] } });
                const div = document.createElement('div');
                div.className = 'report-img-item';
                div.innerHTML = `<img src="${img.src}"><div class="report-img-caption">EVIDENCE #${idx+1}</div>`;
                gallery.appendChild(div);
            }
        });
        if(imageParts.length === 0) { alert("ì‚¬ì§„ì„ ìµœì†Œ 1ì¥ ì´ìƒ ë“±ë¡í•´ì£¼ì„¸ìš”."); return; }

        document.querySelectorAll('.no-print').forEach(el => el.style.display = 'none');
        resultArea.style.display = 'block';
        loading.style.display = 'block';
        contentDiv.style.display = 'none';
        chartSection.style.display = 'none';
        window.scrollTo(0, 0);

        let tdrVal = 0;
        let tdrMsg = "ë°ì´í„° ë¶€ì¡±";
        if(tempSurf && tempIn && tempOut) {
            let den = parseFloat(tempIn) - parseFloat(tempOut);
            if(den === 0) den = 1;
            tdrVal = (parseFloat(tempIn) - parseFloat(tempSurf)) / den;
            tdrVal = tdrVal.toFixed(2);
            if(tdrVal > 0.28) tdrMsg = `TDR ${tdrVal} (ê¸°ì¤€ 0.28 ì´ˆê³¼ â†’ ë‹¨ì—´ ì„±ëŠ¥ ë¯¸ë‹¬ ìœ ë ¥)`;
            else tdrMsg = `TDR ${tdrVal} (ê¸°ì¤€ 0.28 ì´í•˜ â†’ ë‹¨ì—´ ì–‘í˜¸, í™˜ê¸° ë¶€ì¡± ì˜ì‹¬)`;
        }

        let spacerLogic = consideration.includes("TPS") || consideration.includes("TGI")
            ? "í˜„ì¬ 'ë‹¨ì—´ ê°„ë´‰(TPS/TGI)'ì´ ì ìš©ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ê°„ë´‰ìœ¼ë¡œ ì¸í•œ ì—´êµ(Cold Bridge)ëŠ” ê²°ë¡œì˜ ì£¼ëœ ì›ì¸ì—ì„œ **ì œì™¸**í•˜ì‹­ì‹œì˜¤."
            : "ì•Œë£¨ë¯¸ëŠ„ ê°„ë´‰ì´ ì ìš©ë˜ì—ˆìœ¼ë¯€ë¡œ, ìœ ë¦¬ í…Œë‘ë¦¬ì˜ ì—´êµ í˜„ìƒì„ ì§€ì í•˜ì‹­ì‹œì˜¤.";

        let slidingLogic = "ë¯¸ì„œê¸°(Sliding) ì°½í˜¸ì˜ íŠ¹ì„±ìƒ ë ˆì¼ í‹ˆìƒˆë¡œ ì™¸í’(Infiltration)ì´ ìœ ì…ë˜ì–´ ê²°ë¡œë¥¼ ì‹¬í™”ì‹œí‚¬ ìˆ˜ ìˆìŒì„ ì–¸ê¸‰í•˜ì‹­ì‹œì˜¤. ë‹¨, **'ì°½í˜¸ êµì²´'ë¼ëŠ” ë‹¨ì–´ëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ê³ **, ëª¨í—¤ì–´ êµì²´ë‚˜ í’ì§€íŒ ì„¤ì¹˜ ë“± ë³´ìˆ˜ ë°©ë²•ì„ ì œì•ˆí•˜ì‹­ì‹œì˜¤.";

        const currentMonth = new Date().getMonth() + 1;
        const isWinter = (currentMonth >= 11 || currentMonth <= 2);
        let airQualityLogic = "";
        if(vapVal && mixVal) {
            let wg = isWinter ? "í˜„ì¬ ì§„ë‹¨ ì‹œì ì€ **ê²¨ìš¸ì² **ì´ë©°, **ì‹ ì¶• ì•„íŒŒíŠ¸ ê¸°ì¤€ ì ì • ê³µê¸°ì§ˆì€ VAP 1.2kPa ì´í•˜, MIX 7.3g/kg ì´í•˜**ì…ë‹ˆë‹¤. ì´ ìˆ˜ì¹˜ë¥¼ ì´ˆê³¼í•˜ë©´ í™˜ê¸° ë¶€ì¡±ì´ ì›ì¸ì¼ ê°€ëŠ¥ì„±ì´ ë†’ê³ , ì´í•˜ë¼ë©´ ë‹¨ì—´ ë¯¸í¡ì´ ì›ì¸ì¼ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤." : "";
            airQualityLogic = `[ì¤‘ìš”] ê³µê¸°ì§ˆ ë°ì´í„°(VAP: ${vapVal}kPa, MIX: ${mixVal}g/kg) ë¶„ì„. ${wg}`;
        } else {
            airQualityLogic = "VAP/MIX ë°ì´í„°ê°€ ì—†ìœ¼ë¯€ë¡œ TDRê³¼ ì˜¨ìŠµë„ ìœ„ì£¼ë¡œ ë¶„ì„í•˜ì‹­ì‹œì˜¤.";
        }

        let windowSpecifics = winType.includes("ì…ë©´ë¶„í• ")
            ? "- ì…ë©´ë¶„í• ì°½ íŠ¹ì„±: í•˜ë‹¨ë¶€ í†µë°”(Transom) ë° í”„ë ˆì„ ì ‘í•©ë¶€ì˜ ë‹¨ì—´ ì·¨ì•½ì„±ì„ ì§‘ì¤‘ ë¶„ì„í•˜ì‹­ì‹œì˜¤."
            : `- **ë§¤ìš° ì¤‘ìš”**: ì‚¬ìš©ìê°€ ì„ íƒí•œ ì°½í˜¸ëŠ” '${winType}'ì…ë‹ˆë‹¤. ë¶„ì„ ì‹œ ë°˜ë“œì‹œ ì´ ì°½í˜¸ ì¢…ë¥˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ê³ , ì„ íƒí•˜ì§€ ì•Šì€ ë‹¤ë¥¸ ì°½í˜¸ì— ëŒ€í•œ ì–¸ê¸‰ì€ ì ˆëŒ€ í•˜ì§€ ë§ˆì‹­ì‹œì˜¤.`;

        const concreteLogic = "- ê±´ë¬¼ íŠ¹ì„±ìƒ ì½˜í¬ë¦¬íŠ¸ ë° ëª°íƒˆì˜ ì–‘ìƒ ê³¼ì •ì—ì„œ ë°©ì¶œë˜ëŠ” 'ì´ˆê¸° ê±´ì¶•ë¬¼ ìŠµê¸°(Construction Moisture)'ê°€ ê²°ë¡œì˜ ì›ì¸ì´ ë  ìˆ˜ ìˆìŒì„ ë°˜ë“œì‹œ ì–¸ê¸‰í•˜ì‹­ì‹œì˜¤.";

        try {
            const genAI = new GoogleGenerativeAI(API_KEY);
            const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash" });
            const dbContext = JSON.stringify(CONDENSATION_DB);

            const prompt = `
                ë‹¹ì‹ ì€ 'ê±´ì¶•ë¬¼ë¦¬ ë°•ì‚¬'ì´ì 'ê²°ë¡œ ì§„ë‹¨ ìµœê³  ì „ë¬¸ê°€'ì´ë©° 'í•˜ì ì§„ë‹¨ ê°ì •ì‚¬'ì…ë‹ˆë‹¤. 
                ì œê³µëœ í˜„ì¥ ë°ì´í„°ì™€ [í‘œì¤€ ë°ì´í„°ë² ì´ìŠ¤]ë¥¼ ë°”íƒ•ìœ¼ë¡œ **ìµœê³  ìˆ˜ì¤€ì˜ ì •ë°€ ì§„ë‹¨ ë³´ê³ ì„œ**ë¥¼ ì‘ì„±í•˜ì‹­ì‹œì˜¤.
                
                ëª¨ë“  ë¶„ì„ì€ ê³¼í•™ì  ê·¼ê±°ì™€ ìˆ˜ì¹˜ ë°ì´í„°ì— ê¸°ë°˜í•˜ì—¬ ì‘ì„±í•˜ê³ , ì§„ë‹¨ì˜ ì‹ ë¢°ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ê´€ë ¨ ê±´ì¶• ê¸°ì¤€(KS F 2295, ISO 10211, ê±´ì¶•ë¬¼ ì—ë„ˆì§€ì ˆì•½ ì„¤ê³„ê¸°ì¤€ ë“±)ì„ ì¸ìš©í•˜ì‹­ì‹œì˜¤.

                [ì°¸ì¡° ë°ì´í„°ë² ì´ìŠ¤]
                ${dbContext}

                [í˜„ì¥ ë°ì´í„°]
                - êµ¬ì¡°/ì°½í˜¸: ${winType} / ${houseType}
                - **ê°„ë´‰ ì¢…ë¥˜**: ${consideration}
                - ì‹¤ë‚´: ${tempIn}Â°C / ${humid}% (ë…¸ì : ${dew})
                - ì‹¤ì™¸: ${tempOut}Â°C / í‘œë©´ì˜¨ë„: ${tempSurf}Â°C
                - ê³µê¸°ì§ˆ(ì„ íƒ): VAP ${vapVal || 'N/A'}, MIX ${mixVal || 'N/A'}
                - ì¦ìƒ: ${defect}
                - **í•µì‹¬ TDR ë¶„ì„ê°’**: ${tdrMsg}

                [íŠ¹ë³„ ì§€ì‹œì‚¬í•­ (ë°˜ë“œì‹œ ì¤€ìˆ˜)]
                1. **ì°½í˜¸ ì¢…ë¥˜ ì—„ìˆ˜**: ${windowSpecifics}
                2. **ê°„ë´‰ ë¶„ì„**: ${spacerLogic}
                3. **ì°½í˜¸ ê¸°ë°€ì„±**: ${slidingLogic}
                4. **ê³µê¸°ì§ˆ ë¶„ì„(ê²¨ìš¸ì²  ê¸°ì¤€ í¬í•¨)**: ${airQualityLogic}
                5. **ì½˜í¬ë¦¬íŠ¸ íŠ¹ì„±**: ${concreteLogic}
                6. **ë…¼ë¦¬ì  íŒì •**: 
                   - í‘œë©´ì˜¨ë„ê°€ ë…¸ì ì˜¨ë„ë³´ë‹¤ ë‚®ì€ì§€ í™•ì¸ (T_surf < T_dp â†’ ê²°ë¡œ ë°œìƒ)
                   - TDR 0.28 ê¸°ì¤€ ì ìš©, VAP/MIX ì¢…í•©í•˜ì—¬ ìµœì¢… ê·€ì±…(ì‚¬ìš©ì vs ì‹œê³µì‚¬) ì¶”ì •
                   - ê²°ë¡œ ë°œìƒ í™•ë¥ ì„ % ìˆ˜ì¹˜ë¡œ ì œì‹œí•˜ì‹­ì‹œì˜¤.
                7. **ê¸ˆì§€ì–´**: 'ê¸°ìˆ ì‚¬', 'í˜‘íšŒ', 'ì°½í˜¸ êµì²´ ê¶Œìœ '

                [ì¶œë ¥ í¬ë§· - Markdown]
                
                ## ğŸ“Š 1. ì •ë°€ ë°ì´í„° ë¶„ì„
                
                | í•­ëª© | ì¸¡ì •ê°’ | ê¸°ì¤€ê°’ | íŒì • |
                |------|--------|--------|------|
                (TDR, ë…¸ì , í‘œë©´ì˜¨ë„, VAP, MIX ë“± í…Œì´ë¸”ë¡œ ì •ë¦¬)
                
                > **í•µì‹¬ íŒì •**: (ê²°ë¡œ ë°œìƒ ì—¬ë¶€ì™€ í™•ë¥ ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ)
                
                ## ğŸ”¬ 2. ì§„ë‹¨ ê²°ê³¼ ë° ë°œìƒ ë©”ì»¤ë‹ˆì¦˜
                
                ### 2-1. 1ì°¨ ì›ì¸ (Primary Cause)
                (ê°€ì¥ ìœ ë ¥í•œ ì›ì¸ì„ ë°ì´í„°ë¡œ ì…ì¦)
                
                ### 2-2. 2ì°¨ ì›ì¸ (Contributing Factor)
                (ë³µí•© ìš”ì¸ ë¶„ì„)
                
                ### 2-3. ë¬¼ë¦¬ì  ë©”ì»¤ë‹ˆì¦˜
                (ê²°ë¡œ â†’ ê³°íŒ¡ì´ â†’ êµ¬ì¡° ì†ìƒ ì§„í–‰ ê³¼ì • ì„¤ëª…)
                
                ## ğŸ› ï¸ 3. ì „ë¬¸ê°€ ì²˜ë°© (Solution Plan)
                
                ### [ì¦‰ì‹œ ì¡°ì¹˜] (ê±°ì£¼ì ì‹¤í–‰ ê°€ëŠ¥)
                (1~3ê°œ êµ¬ì²´ì  ë°©ë²•)
                
                ### [ë‹¨ê¸° ê°œì„ ] (1~3ê°œì›” ë‚´)
                (ì „ë¬¸ ë³´ìˆ˜ ë°©ë²•)
                
                ### [ì¥ê¸° ëŒ€ì±…] (ê·¼ë³¸ í•´ê²°)
                (êµ¬ì¡°ì  ê°œì„ ì•ˆ - êµì²´ ê¶Œìœ  ì œì™¸)
                
                ## âš–ï¸ 4. ê·€ì±… ì‚¬ìœ  ë¶„ì„
                (ì‚¬ìš©ì ê³¼ì‹¤ vs ì‹œê³µ í•˜ì ë¹„ìœ¨ ì¶”ì • ë° ê·¼ê±°)

                ë§ˆì§€ë§‰ì— ì•„ë˜ JSON í¬í•¨ (ì°¨íŠ¸ìš©):
                ___JSON_START___
                {"ventilation": ìˆ˜ì¹˜, "insulation": ìˆ˜ì¹˜, "construction_moisture": ìˆ˜ì¹˜, "normal": ìˆ˜ì¹˜}
                ___JSON_END___
                (4ê°œ í•­ëª© í•©ì´ 100ì´ ë˜ë„ë¡, ë°ì´í„°ì— ê¸°ë°˜í•˜ì—¬ ë¹„ìœ¨ ì‚°ì •)
            `;

            const result = await model.generateContent({ contents: [{ parts: [{ text: prompt }, ...imageParts] }] });
            const response = await result.response;
            let text = response.text();

            let jsonMatch = text.match(/___JSON_START___([\s\S]*?)___JSON_END___/);
            if(jsonMatch) {
                try {
                    const jsonData = JSON.parse(jsonMatch[1].trim());
                    drawChart(jsonData);
                    chartSection.style.display = 'block';
                } catch(e) {}
                text = text.replace(jsonMatch[0], "");
            }

            const md = window.markdownit();
            contentDiv.innerHTML = md.render(text);
            loading.style.display = 'none';
            contentDiv.style.display = 'block';

        } catch(e) {
            loading.style.display = 'none';
            contentDiv.style.display = 'block';
            contentDiv.innerHTML = `<div style="color:var(--accent-red); text-align:center; padding:30px;">
                <i class="fas fa-exclamation-triangle" style="font-size:2rem; margin-bottom:10px;"></i><br>
                ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>
                <span style="font-size:0.8rem; color:var(--text-muted);">ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì‚¬ì§„ ìš©ëŸ‰ì„ ì¤„ì—¬ì£¼ì„¸ìš”.</span>
            </div>`;
        }
    };

    function drawChart(data) {
        var d = google.visualization.arrayToDataTable([
            ['ì›ì¸', 'ë¹„ìœ¨'],
            ['ì‚¬ìš©ì í™˜ê¸° ë¶€ì¡±', data.ventilation || 0],
            ['ë‹¨ì—´/ì‹œê³µ ë¯¸í¡', data.insulation || 0],
            ['ì´ˆê¸° ê±´ì¶•ë¬¼ ìŠµê¸°', data.construction_moisture || 0],
            ['ê¸°íƒ€ ë³µí•© ìš”ì¸', data.normal || 0]
        ]);
        var options = {
            title: 'ê·€ì±… ì‚¬ìœ  ë¶„ì„ (AI ì¶”ì •)',
            titleTextStyle: { color: '#1b3a5c', fontSize: 13, bold: true },
            is3D: true,
            slices: {
                0: { color: '#b8860b' },
                1: { color: '#c62828', offset: 0.08 },
                2: { color: '#1b3a5c' },
                3: { color: '#2e7d32' }
            },
            backgroundColor: 'transparent',
            chartArea: { left: 10, top: 40, width: '55%', height: '75%' },
            legend: { position: 'right', alignment: 'center', textStyle: { color: '#3d4a5c', fontSize: 11 } },
            pieSliceBorderColor: 'transparent'
        };
        var c = new google.visualization.PieChart(document.getElementById('chart_div'));
        c.draw(d, options);
    }
</script>
</body>
</html>
